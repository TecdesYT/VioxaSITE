<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>MiniTube ‚Äì Comptes & Cha√Ænes (local)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family: Roboto, Arial, sans-serif; background:#0f0f0f; color:#fff; }
    header { height:56px; display:flex; align-items:center; gap:12px; padding:0 16px; background:#181818; border-bottom:1px solid #303030; }
    header input { flex:1; padding:8px; background:#121212; border:1px solid #303030; color:#fff; }
    header button { padding:8px 12px; background:#303030; border:none; color:#fff; cursor:pointer; }
    .layout { display:grid; grid-template-columns:240px 1fr; height:calc(100vh - 56px); }
    aside { background:#181818; padding:12px; border-right:1px solid #303030; }
    main { padding:16px; overflow-y:auto; }
    .card { background:#181818; padding:12px; border-radius:8px; margin-bottom:12px; }
    .btn { padding:6px 10px; background:#cc0000; border:none; color:white; cursor:pointer; border-radius:4px; }
    .btn.gray { background:#303030; }
    textarea { width:100%; background:#121212; color:white; border:1px solid #303030; padding:6px; }
  </style>
</head>
<body>
<header>
  <strong>MiniTube</strong>
  <input id="search" placeholder="Rechercher une cha√Æne" />
  <button onclick="searchChannel()">üîç</button>
</header>

<div class="layout">
  <aside>
    <div class="card">
      <h3>Cr√©er un compte</h3>
      <input id="username" placeholder="Nom de la cha√Æne" />
      <button class="btn" onclick="createAccount()">Cr√©er</button>
    </div>
    <div class="card" id="currentUser"></div>
  </aside>

  <main>
    <div id="channelView"></div>
    <div id="comments"></div>
  </main>
</div>

<script>
  let users = JSON.parse(localStorage.getItem('users') || '{}');
  let currentUser = localStorage.getItem('currentUser');

  function save() {
    localStorage.setItem('users', JSON.stringify(users));
    localStorage.setItem('currentUser', currentUser);
  }

  function createAccount() {
    const name = username.value.trim();
    if (!name || users[name]) return alert('Nom invalide ou d√©j√† pris');
    users[name] = { subs: [], comments: [] };
    currentUser = name;
    save();
    renderCurrent();
  }

  function renderCurrent() {
    currentUserDiv.innerHTML = currentUser
      ? `<p>Connect√© : <b>${currentUser}</b></p>`
      : '<p>Non connect√©</p>';
  }

  function searchChannel() {
    const q = search.value.trim();
    if (!users[q]) return alert('Cha√Æne introuvable');

    const subscribed = currentUser && users[q].subs.includes(currentUser);

    channelView.innerHTML = `
      <div class="card">
        <h2>${q}</h2>
        <p>${users[q].subs.length} abonn√©s</p>
        ${currentUser && currentUser !== q ?
          `<button class="btn ${subscribed ? 'gray' : ''}" onclick="toggleSub('${q}')">
            ${subscribed ? 'Se d√©sabonner' : 'S\'abonner'}
          </button>` : ''}
      </div>
    `;

    renderComments(q);
  }

  function toggleSub(channel) {
    const subs = users[channel].subs;
    if (subs.includes(currentUser))
      users[channel].subs = subs.filter(s => s !== currentUser);
    else subs.push(currentUser);
    save();
    searchChannel();
  }

  function renderComments(channel) {
    comments.innerHTML = `
      <div class="card">
        <h3>Commentaires</h3>
        ${currentUser ? `<textarea id="commentText"></textarea>
        <button class="btn" onclick="addComment('${channel}')">Commenter</button>` : '<p>Connecte-toi pour commenter</p>'}
        <div>${users[channel].comments.map(c => `<p><b>${c.user}</b> : ${c.text}</p>`).join('')}</div>
      </div>
    `;
  }

  function addComment(channel) {
    const text = commentText.value.trim();
    if (!text) return;
    users[channel].comments.unshift({ user: currentUser, text });
    save();
    renderComments(channel);
  }

  const currentUserDiv = document.getElementById('currentUser');
  renderCurrent();
</script>
</body>
</html>
